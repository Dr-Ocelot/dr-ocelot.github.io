<!DOCTYPE html>
<html>
  <head>
    <!--META TAGS-->
    <meta charset="utf-8"> <!--future proofs the character set-->
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <!--makes the page actually work on mobile-->
    <meta http-equiv="refresh" content="60"> <!--automatically refresh the page every minute-->
    <!--LOAD MATERIALIZE-->
    <!--MATERIALIZE IS A REALLY COOL, OPEN-SOURCE CSS AND JS LIRBRARY BASED ON GOOGLE'S MATERIAL DEISGN STANDARDS-->
    <!--MORE INFO: http://materializecss.com/-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0-beta/css/materialize.min.css">
    <!--LOAD ROBOTO FONT-->
    <link href="https://fonts.googleapis.com/css?family=Roboto:400,700" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,700" rel="stylesheet">
    <!--LOAD CUSTOM CSS-->
    <link rel='stylesheet' href='style.css'>
    <link rel='stylesheet' href='light.css' title="Light">
    
  </head>
</html>
<body>
  <div class='container'>
    <h4 style='text-align: center'><b>Y.A.L.E. SCHOOL CHERRY HILL BUS STATUS</b></h4>
    <h5 style='text-align: center; margin-top: 0px; padding-top: 0px;'><b>LIVE DEMO</b></h5>
    <p style='text-align: center'>This page automatically refreshes every minute.</p>
    <br>
    <div class='input-field inline'> <!--bus text input-->
      <input type="text" id="bus-input" name="buschoice" maxlength="2" size='2'>
      <label for="bus-input">Bus #</label>
    </div>
    <!--buttons-->
    <button class='waves-effect waves-automatic btn-flat' onclick="hideBus()">HIDE BUS</button> 
    <button class='waves-effect waves-automatic btn-flat' onclick="showBus()">SHOW BUS</button>
    <button class='waves-effect waves-automatic btn-flat'onclick="hideAll()">HIDE ALL</button>
    <button class='waves-effect waves-automatic btn-flat'onclick="showAll()">SHOW All</button>
    <!--theme selector-->
    <div class="input-field inline">
      <select id='theme-selector' onchange="changeTheme()">
        <option value="0">Light</option>
        <option value="1">Dark</option>
      </select>
      <label>Theme</label>
    </div>
    
    
    
    <div class='row'>
<!--      All of the tiles in the bus list. Lotsa markup!-->
      <div class="col number-box" id="bus-1">
        <div class="number">01</div>
        <div class="arrived-text">ARRIVED</div>
      </div>
      <div class="col number-box" id="bus-2">
        <div class="number">02</div>
        <div class="arrived-text">ARRIVED</div>
      </div>
      <div class="col number-box" id="bus-3">
        <div class="number">03</div>
        <div class="arrived-text">ARRIVED</div>
      </div>
      <div class="col number-box" id="bus-4">
        <div class="number">04</div>
        <div class="arrived-text">ARRIVED</div>
      </div>
      <div class="col number-box" id="bus-5">
        <div class="number">05</div>
        <div class="arrived-text">ARRIVED</div>
      </div>
      <div class="col number-box" id="bus-6">
        <div class="number">06</div>
        <div class="arrived-text">ARRIVED</div>
      </div>
      <div class="col number-box" id="bus-7">
        <div class="number">07</div>
        <div class="arrived-text">ARRIVED</div>
      </div>
      <div class="col number-box" id="bus-8">
        <div class="number">08</div>
        <div class="arrived-text">ARRIVED</div>
      </div>
      <div class="col number-box" id="bus-9">
        <div class="number">09</div>
        <div class="arrived-text">ARRIVED</div>
      </div>
      <div class="col number-box" id="bus-10">
        <div class="number">10</div>
        <div class="arrived-text">ARRIVED</div>
      </div>
      <div class="col number-box" id="bus-11">
        <div class="number">11</div>
        <div class="arrived-text">ARRIVED</div>
      </div>
      <div class="col number-box" id="bus-12">
        <div class="number">12</div>
        <div class="arrived-text">ARRIVED</div>
      </div>
      <div class="col number-box" id="bus-13">
        <div class="number">13</div>
        <div class="arrived-text">ARRIVED</div>
      </div>
      <div class="col number-box" id="bus-14">
        <div class="number">14</div>
        <div class="arrived-text">ARRIVED</div>
      </div>
      <div class="col number-box" id="bus-15">
        <div class="number">15</div>
        <div class="arrived-text">ARRIVED</div>
      </div>
      <div class="col number-box" id="bus-16">
        <div class="number">16</div>
        <div class="arrived-text">ARRIVED</div>
      </div>
      <div class="col number-box" id="bus-17">
        <div class="number">17</div>
        <div class="arrived-text">ARRIVED</div>
      </div>
      <div class="col number-box" id="bus-18">
        <div class="number">18</div>
        <div class="arrived-text">ARRIVED</div>
      </div>
      <div class="col number-box" id="bus-19">
        <div class="number">19</div>
        <div class="arrived-text">ARRIVED</div>
      </div>
      <div class="col number-box" id="bus-20">
        <div class="number">20</div>
        <div class="arrived-text">ARRIVED</div>
      </div>
      <div class="col number-box" id="bus-21">
        <div class="number">21</div>
        <div class="arrived-text">ARRIVED</div>
      </div>
      <div class="col number-box" id="bus-22">
        <div class="number">22</div>
        <div class="arrived-text">ARRIVED</div>
      </div>
      <div class="col number-box" id="bus-23">
        <div class="number">23</div>
        <div class="arrived-text">ARRIVED</div>
      </div>
      <div class="col number-box" id="bus-24">
        <div class="number">24</div>
        <div class="arrived-text">ARRIVED</div>
      </div>
      <div class="col number-box" id="bus-25">
        <div class="number">25</div>
        <div class="arrived-text">ARRIVED</div>
      </div>
      <div class="col number-box" id="bus-26">
        <div class="number">26</div>
        <div class="arrived-text">ARRIVED</div>
      </div>
      <div class="col number-box" id="bus-27">
        <div class="number">27</div>
        <div class="arrived-text">ARRIVED</div>
      </div>
      <div class="col number-box" id="bus-28">
        <div class="number">28</div>
        <div class="arrived-text">ARRIVED</div>
      </div>
      <div class="col number-box" id="bus-29">
        <div class="number">29</div>
        <div class="arrived-text">ARRIVED</div>
      </div>
      <div class="col number-box" id="bus-30">
        <div class="number">30</div>
        <div class="arrived-text">ARRIVED</div>
      </div>
      <div class="col number-box" id="bus-31">
        <div class="number">31</div>
        <div class="arrived-text">ARRIVED</div>
      </div>
      <div class="col number-box" id="bus-32">
        <div class="number">32</div>
        <div class="arrived-text">ARRIVED</div>
      </div>
      <div class="col number-box" id="bus-33">
        <div class="number">33</div>
        <div class="arrived-text">ARRIVED</div>
      </div>
      <div class="col number-box" id="bus-34">
        <div class="number">34</div>
        <div class="arrived-text">ARRIVED</div>
      </div>
      <div class="col number-box" id="bus-35">
        <div class="number">35</div>
        <div class="arrived-text">ARRIVED</div>
      </div>
      <div class="col number-box" id="bus-36">
        <div class="number">36</div>
        <div class="arrived-text">ARRIVED</div>
      </div>
      <div class="col number-box" id="bus-37">
        <div class="number">37</div>
        <div class="arrived-text">ARRIVED</div>
      </div>
      <div class="col number-box" id="bus-38">
        <div class="number">38</div>
        <div class="arrived-text">ARRIVED</div>
      </div>
      <div class="col number-box" id="bus-39">
        <div class="number">39</div>
        <div class="arrived-text">ARRIVED</div>
      </div>
      <div class="col number-box" id="bus-40">
        <div class="number">40</div>
        <div class="arrived-text">ARRIVED</div>
      </div>
      <div class="col number-box" id="bus-41">
        <div class="number">41</div>
        <div class="arrived-text">ARRIVED</div>
      </div>
      <div class="col number-box" id="bus-42">
        <div class="number">42</div>
        <div class="arrived-text">ARRIVED</div>
      </div>
      <div class="col number-box" id="bus-43">
        <div class="number">43</div>
        <div class="arrived-text">ARRIVED</div>
      </div>
      <div class="col number-box" id="bus-44">
        <div class="number">44</div>
        <div class="arrived-text">ARRIVED</div>
      </div>
      <div class="col number-box" id="bus-45">
        <div class="number">45</div>
        <div class="arrived-text">ARRIVED</div>
      </div>
      <div class="col number-box" id="bus-46">
        <div class="number">46</div>
        <div class="arrived-text">ARRIVED</div>
      </div>
      <div class="col number-box" id="bus-47">
        <div class="number">47</div>
        <div class="arrived-text">ARRIVED</div>
      </div>
      <div class="col number-box" id="bus-48">
        <div class="number">48</div>
        <div class="arrived-text">ARRIVED</div>
      </div>
      <div class="col number-box" id="bus-49">
        <div class="number">49</div>
        <div class="arrived-text">ARRIVED</div>
      </div>
      <div class="col number-box" id="bus-50">
        <div class="number">50</div>
        <div class="arrived-text">ARRIVED</div>
      </div>
      <div class="col number-box" id="bus-51">
        <div class="number">51</div>
        <div class="arrived-text">ARRIVED</div>
      </div>
      <div class="col number-box" id="bus-52">
        <div class="number">52</div>
        <div class="arrived-text">ARRIVED</div>
      </div>
      <div class="col number-box" id="bus-53">
        <div class="number">53</div>
        <div class="arrived-text">ARRIVED</div>
      </div>
      <div class="col number-box" id="bus-54">
        <div class="number">54</div>
        <div class="arrived-text">ARRIVED</div>
      </div>
      <div class="col number-box" id="bus-55">
        <div class="number">55</div>
        <div class="arrived-text">ARRIVED</div>
      </div>
      <div class="col number-box" id="bus-56">
        <div class="number">56</div>
        <div class="arrived-text">ARRIVED</div>
      </div>
      <div class="col number-box" id="bus-57">
        <div class="number">57</div>
        <div class="arrived-text">ARRIVED</div>
      </div>
      <div class="col number-box" id="bus-58">
        <div class="number">58</div>
        <div class="arrived-text">ARRIVED</div>
      </div>
      <div class="col number-box" id="bus-59">
        <div class="number">59</div>
        <div class="arrived-text">ARRIVED</div>
      </div>
      <div class="col number-box" id="bus-60">
        <div class="number">60</div>
        <div class="arrived-text">ARRIVED</div>
      </div>
      <div class="col number-box" id="bus-61">
        <div class="number">61</div>
        <div class="arrived-text">ARRIVED</div>
      </div>
      <div class="col number-box" id="bus-62">
        <div class="number">62</div>
        <div class="arrived-text">ARRIVED</div>
      </div>
      <div class="col number-box" id="bus-63">
        <div class="number">63</div>
        <div class="arrived-text">ARRIVED</div>
      </div>
      <div class="col number-box" id="bus-64">
        <div class="number">64</div>
        <div class="arrived-text">ARRIVED</div>
      </div>
      <div class="col number-box" id="bus-65">
        <div class="number">65</div>
        <div class="arrived-text">ARRIVED</div>
      </div>
      <div class="col number-box" id="bus-66">
        <div class="number">66</div>
        <div class="arrived-text">ARRIVED</div>
      </div>
      <div class="col number-box" id="bus-67">
        <div class="number">67</div>
        <div class="arrived-text">ARRIVED</div>
      </div>
      <div class="col number-box" id="bus-68">
        <div class="number">68</div>
        <div class="arrived-text">ARRIVED</div>
      </div>
      <div class="col number-box" id="bus-69">
        <div class="number">69</div>
        <div class="arrived-text">ARRIVED</div>
      </div>
      <div class="col number-box" id="bus-70">
        <div class="number">70</div>
        <div class="arrived-text">ARRIVED</div>
      </div>
      <div class="col number-box" id="bus-71">
        <div class="number">71</div>
        <div class="arrived-text">ARRIVED</div>
      </div>
      <div class="col number-box" id="bus-72">
        <div class="number">72</div>
        <div class="arrived-text">ARRIVED</div>
      </div>
      <div class="col number-box" id="bus-73">
        <div class="number">73</div>
        <div class="arrived-text">ARRIVED</div>
      </div>
      <div class="col number-box" id="bus-74">
        <div class="number">74</div>
        <div class="arrived-text">ARRIVED</div>
      </div>
      <div class="col number-box" id="bus-75">
        <div class="number">75</div>
        <div class="arrived-text">ARRIVED</div>
      </div>
      <div class="col number-box" id="bus-76">
        <div class="number">76</div>
        <div class="arrived-text">ARRIVED</div>
      </div>
      
    </div>
    
    <p style='text-align: center'>This is a live demo of the potential upcoming bus list. The 'arrived' buses are generated randomly upon the page loading.</p>
  </div>
<!--  Load jQuery-->
  <script type="text/javascript" src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<!--  Load jQuery Cookie-->
  <script src="jquery.cookie-1.4.1.min.js"></script>
<!--  Load Materialize's Javascript-->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0-beta/js/materialize.min.js"></script>
<!--  Custom JS-->
  <script>
    var busTotal = 76; //CHANGE THIS TO THE TOTAL BUSES!
    
    if ($.cookie('hiddenbuses') != undefined) { //if the cookie for the hidden buses exists...
      var hiddenBusesCookie = $.cookie('hiddenbuses').split(","); //transfer the cookie to a variable
    }
    else { //if it doesn't exist
      var hiddenBusesCookie = []; //create a blank variable
    } //end if
    
    var hiddenBuses = []; //declares a blank variable for the hidden buses
    
    for (i=0;i<hiddenBusesCookie.length;i++) { //loops once for every entry in the hidden buses cookie
      hiddenBuses.push($('#bus-' + hiddenBusesCookie[i])); //adds the currently selected array index to the hidden buses variable
    } //end loop
        
//    Initialise Dropdown function
    function initDropdown() { //     This code was given by the Materialize documentation.
      $(document).ready(function(){// It allows the dropdown menu for the theme selector to work.
        $('select').formSelect();//        
      });
    }
    initDropdown();//runs the initialise dropdown function
    
//    Function to store the current array of hidden buses to a cookie
    function storeBuses() { //declares the function
      var hiddenBusesCookie = [] //clears the cookie variable
      for (i=0;i<hiddenBuses.length;i++) { //loops once for every entry in the hidden buses variable
        hiddenBusesCookie.push(hiddenBuses[i][0].id.replace("bus-","")); //adds the currently selected array index to the hidden buses cookie variable
      } //end loop
      $.cookie('hiddenbuses', hiddenBusesCookie.join(",")); //writes the hidden buses to a cookie
    }
    
//    Function to refresh which buses are hidden and which are shown
    function modifyBuses() { //declares the function
      $('div.row div').show(); //shows every bus
      $.each(hiddenBuses, function() { //for each of the hidden buses in the array...
          $(this).hide(); //hide it
      });
    }
    
//    Function to remove hidden buses from array
    function remove(array, element) { //declares the function
        var index = hiddenBuses.findIndex(x => x[0].id==element); //creates a variable for the index in the hidden buses array for which the requested bus is located

      while (index !== -1) { //while loop to handle the possibility that the hidden bus entry was somehow placed in more than once
          array.splice(index, 1); //removes the entry
          var index = hiddenBuses.findIndex(x => x[0].id==element); //checks if there are any more entries
      } //end loop
    }
    
//    Function to hide the bus typed in the box
    function hideBus() { //declares the function
      if (hiddenBuses.findIndex(x => x[0].id=='bus-' + $('#bus-input').val()) == -1) { //if the bus requesting to be hidden isn't already hidden...
        hiddenBuses.push($('#bus-' + $('#bus-input').val())); //hide it (adds the bus to the list of hidden buses)
      } //end if
      modifyBuses(); //refreshes buses
      storeBuses(); //stores the cookie
    }
//    Function to show the bus typed in the box
    function showBus() { //declares the function
      remove(hiddenBuses,'bus-' + $('#bus-input').val()); //takes the bus out of the index of hidden buses
      modifyBuses(); //refreshes buses
      storeBuses(); //stores the cookie
    }
//    Function to hide all of the buses
    function hideAll() { //declares the function
      hiddenBuses = []; //clears the current index of hidden buses
      for (i = 1; i <= busTotal; i++) { //loops for every bus there is (this is where the total bus variable is used!!)
        hiddenBuses.push($('#bus-' + i)); //adds the current bus in the loop to the list of hidden buses
      }
      modifyBuses(); //refreshes buses
      storeBuses(); //stores the cookie
    }
//    Function to show all of the buses
    function showAll() { //declares the function
      hiddenBuses = []; //clears the current index of hidden buses
      modifyBuses(); //refreshes buses
      storeBuses(); //stores the cookie
    }
//    Apply the selected theme upon the page loading
    if ($.cookie('themepref') == "light") { //if the theme cookie specifies the user chose 'light'
      useLight() //load the light theme
    }
    else { //otherwise
      useDark() //load the dark theme
    }
//    Function to change theme after selecting one from the dropdown
    function changeTheme() { //declares the function
      if ($('#theme-selector').val() == 0) { //if they chose the first value (light theme)
        useLight(); //load the light theme
      }
      else { //otherwise
        useDark(); //load the dark theme
      } //end if
    }
    
//    Function to change to light theme
    var cssLink; //creates a variable to find which css is being used
    function useLight(){ //declares the function
      cssLink = $('link[href*="dark.css"]'); //sets the variable to look for the a style for the dark theme
      cssLink.replaceWith('<link href="light.css" type="text/css" rel="stylesheet">'); //replaces that css with the light theme
      document.cookie = "themepref=light" //sets the cookie to light theme
      document.getElementById("theme-selector").options.selectedIndex = 0; //changes the dropdown to the light theme
      initDropdown(); //refreshes dropdown
    }
//    Change to dark theme
    function useDark(){ //declares the function
      cssLink = $('link[href*="light.css"]'); //sets the variable to look for the a style for the light theme
      cssLink.replaceWith('<link href="dark.css" type="text/css" rel="stylesheet">'); //replaces that css with the dark theme
      document.cookie = "themepref=dark"; //sets the cookie to dark theme
      document.getElementById("theme-selector").options.selectedIndex = 1; //changes the dropdown to the dark theme
      initDropdown(); //refreshes dropdown
    }

//    Applies the hidden bus settings
    if (hiddenBusesCookie[0] !== "") { //if the cookie isn't blank
      modifyBuses(); //refresh the buses
    }
    else { //otherwise
      hiddenBuses = []; //set the hiddenBuses array to be blank
    }
  </script>
  <script>
//    Bus RNG (used for the demostration page)
    //THIS SHOULD NOT RUN ON THE ACTUAL SITE
    for (i=1;i<=busTotal;i++) { //loops for every bus on the page
      $('#bus-' + i).removeClass('arrived') //removes the arrived class if they have it   
      if (Math.floor(Math.random() * 3) == 1) { //if the 1/3 chance was successful...
      $('#bus-' + i).addClass('arrived') //make the bus appear as arrived
      }
    } //end loop
  </script>
</body>